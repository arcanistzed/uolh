---
import { changeLanguage, setDefaultNamespace, t } from "i18next";
import { localizePath } from "astro-i18next";
import { LanguageSelector } from "astro-i18next/components";
import { Icon } from "astro-icon/components";

setDefaultNamespace("navbar");
---

<nav
	aria-label="Navigation Bar"
	class="border-b-4 border-primary/50 text-center text-secondary"
>
	<div class="flex items-center justify-between px-4 py-2 md:hidden">
		<a href={localizePath("/")} class="block">
			<h1 class="text-2xl text-tertiary">{t("home")}</h1>
		</a>
		<button
			id="mobile-menu-button"
			aria-label="Toggle mobile menu"
			aria-expanded="false"
			aria-controls="mobile-menu"
			class="relative text-secondary hover:text-tertiary focus:outline-none z-50"
		>
			<Icon id="menu-icon-hamburger" name="line-md:menu" class="h-8 w-8" aria-hidden="true" />
			<Icon id="menu-icon-close" name="line-md:close" class="h-8 w-8 absolute inset-0 hidden" aria-hidden="true" />
		</button>
	</div>
	<ul
		id="mobile-menu"
		class="fixed inset-0 z-40 hidden flex-col items-center justify-center gap-6 bg-background translate-x-full transition-transform duration-300 md:static md:flex md:flex-row md:gap-0 md:w-auto md:bg-transparent md:p-0 md:translate-x-0"
		aria-hidden="true"
	>
		<li class="hidden md:block md:mr-auto">
			<a href={localizePath("/")} class="block py-2 md:p-3">
				<h1 class="text-2xl text-tertiary">{t("home")}</h1>
			</a>
		</li>
		<li class="w-full text-center md:w-fit">
			<a
				href={localizePath("/events")}
				class="block w-full py-3 text-xl transition-colors duration-500 hover:bg-secondary hover:text-white md:p-4 md:text-base rounded md:rounded-none"
			>
				{t("events")}
			</a>
		</li>
		<li class="w-full text-center md:w-fit">
			<a
				href={localizePath("/blog")}
				class="block w-full py-3 text-xl transition-colors duration-500 hover:bg-secondary hover:text-white md:p-4 md:text-base rounded md:rounded-none"
			>
				{t("blog")}
			</a>
		</li>
		<li class="w-full text-center md:w-fit">
			<a
				href={localizePath("/governance")}
				class="block w-full py-3 text-xl transition-colors duration-500 hover:bg-secondary hover:text-white md:p-4 md:text-base rounded md:rounded-none"
			>
				{t("governance")}
			</a>
		</li>
		<li class="w-full text-center md:w-fit">
			<a
				href={localizePath("/team")}
				class="block w-full py-3 text-xl transition-colors duration-500 hover:bg-secondary hover:text-white md:p-4 md:text-base rounded md:rounded-none"
			>
				{t("team")}
			</a>
		</li>
		<li class="flex items-center justify-center py-2">
			<LanguageSelector
				class="mx-2 block rounded-md border border-secondary/50 bg-transparent px-2 py-2 text-secondary transition-colors duration-500 hover:bg-secondary hover:text-white"
			/>
		</li>
	</ul>
</nav>

<script>
	const button = document.getElementById("mobile-menu-button");
	const menu = document.getElementById("mobile-menu");
	const hamburgerIcon = document.getElementById("menu-icon-hamburger");
	const closeIcon = document.getElementById("menu-icon-close");

	const toggleMenu = () => {
		const isExpanded = button?.getAttribute("aria-expanded") === "true";
		button?.setAttribute("aria-expanded", (!isExpanded).toString());
		menu?.setAttribute("aria-hidden", isExpanded.toString());
		
		if (isExpanded) {
			// Closing: slide out to the right and show hamburger icon
			menu?.classList.add("translate-x-full");
			hamburgerIcon?.classList.remove("hidden");
			closeIcon?.classList.add("hidden");
			setTimeout(() => {
				menu?.classList.add("hidden");
				menu?.classList.remove("flex");
			}, 300);
		} else {
			// Opening: show then slide in from the right and show close icon
			menu?.classList.remove("hidden");
			menu?.classList.add("flex");
			hamburgerIcon?.classList.add("hidden");
			closeIcon?.classList.remove("hidden");
			setTimeout(() => {
				menu?.classList.remove("translate-x-full");
			}, 10);
		}
	};

	button?.addEventListener("click", toggleMenu);
	button?.addEventListener("keydown", (e) => {
		if (e.key === "Enter" || e.key === " ") {
			e.preventDefault();
			toggleMenu();
		}
	});
</script>
